const functions = require('firebase-functions');
const admin = require('firebase-admin');
admin.initializeApp();

exports.deleteUserData = functions.https.onCall(async (data, context) => {
  const email = data.email;
  const password = data.password;
  if (!email || !password) {
    throw new functions.https.HttpsError('invalid-argument', 'Email and password are required');
  }

  try {
    // Kullanıcıyı oturum açtır
    const userRecord = await admin.auth().getUserByEmail(email);
    const uid = userRecord.uid;

    // Kullanıcı verilerini sil
    await admin.database().ref(`users/${uid}`).remove();
    // Kullanıcıyı sil
    await admin.auth().deleteUser(uid);
    return { message: 'User data deleted successfully' };
  } catch (error) {
    throw new functions.https.HttpsError('unknown', `Error deleting user data: ${error.message}`);
  }
});
